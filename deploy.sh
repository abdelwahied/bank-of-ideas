#!/bin/bash

# ุณูุฑูุจุช Deployment ูุจูู ุงูุฃููุงุฑ
# ุงุณุชุฎุฏุงู: ./deploy.sh

set -e  # ุฅููุงู ุนูุฏ ุฃู ุฎุทุฃ

echo "๐ ุจุฏุก ุนูููุฉ Deployment..."

# ุงูุชุญูู ูู ูุฌูุฏ Docker
if ! command -v docker &> /dev/null; then
    echo "โ Docker ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Docker ุฃููุงู."
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ Docker Compose
if ! command -v docker-compose &> /dev/null; then
    echo "โ Docker Compose ุบูุฑ ูุซุจุช. ูุฑุฌู ุชุซุจูุช Docker Compose ุฃููุงู."
    exit 1
fi

# ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู Git
echo "๐ฅ ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู Git..."
git pull origin main

# ุฅููุงู ุงูุญุงููุงุช ุงูุญุงููุฉ
echo "๐ ุฅููุงู ุงูุญุงููุงุช ุงูุญุงููุฉ..."
docker-compose down

# ุจูุงุก ุงูุตูุฑ ุงูุฌุฏูุฏุฉ
echo "๐จ ุจูุงุก ุงูุตูุฑ ุงูุฌุฏูุฏุฉ..."
docker-compose build --no-cache

# ุชุดุบูู ุงูุญุงููุงุช
echo "โถ๏ธ  ุชุดุบูู ุงูุญุงููุงุช..."
docker-compose up -d

# ุงูุชุธุงุฑ ุญุชู ุชุตุจุญ ุงูุญุงููุงุช ุฌุงูุฒุฉ
echo "โณ ุงูุชุธุงุฑ ุญุชู ุชุตุจุญ ุงูุญุงููุงุช ุฌุงูุฒุฉ..."
sleep 10

# ุงูุชุญูู ูู ุญุงูุฉ ุงูุญุงููุงุช
echo "๐ ุญุงูุฉ ุงูุญุงููุงุช:"
docker-compose ps

# ุนุฑุถ ุงูุณุฌูุงุช
echo "๐ ุขุฎุฑ ุงูุณุฌูุงุช:"
docker-compose logs --tail=50

echo "โ ุชู Deployment ุจูุฌุงุญ!"
echo "๐ ุงูุชุทุจูู ูุนูู ุนูู: http://localhost:4000"

